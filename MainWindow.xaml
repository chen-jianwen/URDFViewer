<Window x:Class="URDFViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:h="http://helix-toolkit.org/wpf"
        xmlns:local="clr-namespace:URDFViewer"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        mc:Ignorable="d"
        Title="URDF Viewer" Height="600" Width="800"
        WindowState="Maximized"
        Icon="Assets/Icon.png">
    <!--<Window.Resources>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:BoolToCollapsedVisibilityConverter x:Key="BoolToCollapsedVisibilityConverter"/>
    </Window.Resources>-->

    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Control" Command="{x:Static local:MainWindow.LoadUrdfCommand}" />
        <KeyBinding Key="W" Modifiers="Control" Command="{x:Static local:MainWindow.CloseUrdfCommand}" />
        <KeyBinding Key="Q" Modifiers="Control" Command="{x:Static local:MainWindow.ExitCommand}" />
        <KeyBinding Key="R" Modifiers="Control" Command="{x:Static local:MainWindow.ResetViewCommand}" />
        <KeyBinding Key="F" Modifiers="Control" Command="{x:Static local:MainWindow.ZoomToFitCommand}" />
        <KeyBinding Key="F1" Command="{x:Static local:MainWindow.HelpCommand}" />
        <KeyBinding Key="A" Modifiers="Alt" Command="{x:Static local:MainWindow.AboutCommand}" />
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
            <RowDefinition Height="auto"></RowDefinition>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"></ColumnDefinition>
            <ColumnDefinition Width="7*"></ColumnDefinition>
        </Grid.ColumnDefinitions>

        <!-- 菜单栏 -->
        <Menu Grid.Row="0" Grid.ColumnSpan="2" FontSize="12" >
            <MenuItem Header="文件(_F)" FontSize="12">
                <MenuItem Name="MenuLoadUrdf" Header="加载URDF文件夹(_O)" Click="MenuLoadUrdf_Click" FontSize="12" InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <TextBlock Text="📁" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Name="MenuCloseUrdf" Header="关闭URDF(_C)" Click="MenuCloseUrdf_Click" FontSize="12" InputGestureText="Ctrl+W">
                    <MenuItem.Icon>
                        <TextBlock Text="❌" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Name="MenuExit" Header="退出(_X)" Click="MenuExit_Click" FontSize="12" InputGestureText="Ctrl+Q">
                    <MenuItem.Icon>
                        <TextBlock Text="🚪" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="视图(_V)" FontSize="12">
                <MenuItem Name="MenuResetView" Header="重置视图(_R)" Click="MenuResetView_Click" FontSize="12" InputGestureText="Ctrl+R">
                    <MenuItem.Icon>
                        <TextBlock Text="🔄" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Name="MenuZoomToFit" Header="缩放到适合(_F)" Click="MenuZoomToFit_Click" FontSize="12" InputGestureText="Ctrl+F">
                    <MenuItem.Icon>
                        <TextBlock Text="🔍" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="显示连杆模型" Name="MenuShowLinks" IsCheckable="True" IsChecked="True" Click="MenuShowLinks_Click" FontSize="12"/>
                <MenuItem Header="显示关节坐标系" Name="MenuShowJointCoordinates" IsCheckable="True" IsChecked="True" Click="MenuShowJointCoordinates_Click" FontSize="12"/>
                <!-- 其他菜单项 -->
            </MenuItem>
            <MenuItem Header="帮助(_H)" FontSize="12">
                <MenuItem Name="MenuHelp" Header="帮助中心(_H)" Click="MenuHelp_click" FontSize="12" InputGestureText="F1">
                    <MenuItem.Icon>
                        <TextBlock Text="❓" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Name="MenuAbout" Header="关于(_A)" Click="MenuAbout_Click" FontSize="12" InputGestureText="Alt+A">
                    <MenuItem.Icon>
                        <TextBlock Text="ℹ️" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1" Grid.Column="1">


            <!-- 3D视图及悬浮按钮 -->
            <Grid>
                <h:HelixViewport3D Name="MainViewport"
                                   AllowDrop="True"
                                   Drop="FolderDrop"
                                   Margin="5,5,5,5"
                                   Background="White"
                                   ShowCoordinateSystem="True"
                                   CoordinateSystemLabelForeground="White"
                                   ShowViewCube="True"
                                   ViewCubeBackText="后"
                                   ViewCubeFrontText="前"
                                   ViewCubeLeftText="左"
                                   ViewCubeRightText="右"
                                   ViewCubeTopText="上"
                                   ViewCubeBottomText="下"
                                   IsManipulationEnabled="True"
                                   IsZoomEnabled="True"
                                   IsRotationEnabled="True"
                                   IsPanEnabled="True"
                                   ZoomExtentsWhenLoaded="True"
                                   ViewCubeHorizontalPosition="Right"
                                   ViewCubeVerticalPosition="Top"
                                   IsViewCubeEdgeClicksEnabled="True"
                                   ShowFrameRate="True">
                    <h:DefaultLights/>
                    <h:GridLinesVisual3D Center="0,0,0" Width="1" Length="1" MinorDistance="0.05" MajorDistance="0.01" Thickness="0.001" Fill="Gray"/>
                    <h:CoordinateSystemVisual3D ArrowLengths="0.05"/>
                    <h:HelixViewport3D.Camera>
                        <PerspectiveCamera Position="1.5,1.5,1.5" LookDirection="-1,-1,-1" UpDirection="0,0,1" FieldOfView="45" NearPlaneDistance="0.01" FarPlaneDistance="100"/>
                    </h:HelixViewport3D.Camera>
                </h:HelixViewport3D>
                <!-- 右上角悬浮快捷按钮 -->
                <StackPanel Orientation="Vertical" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,10,0" Panel.ZIndex="10">
                    <Button Content="🔄" Padding="2,2" Margin="10,10,10,10" Click="MenuResetView_Click" FontSize="16"/>
                    <Button Content="🔍" Padding="2,2" Margin="10,10,10,10" Click="MenuZoomToFit_Click" FontSize="16"/>
                </StackPanel>
                <!-- 右上角浮动的关节Slider面板 -->
                <Border Background="#AA222222" CornerRadius="8" Padding="8" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="20" Width="auto">
                    <StackPanel>
                        <TextBlock Text="调整关节角度" Foreground="White" FontWeight="Bold" FontSize="14" Margin="0,0,0,6"/>
                        <StackPanel Name="JointSlidersPanel"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- 左侧：URDF拓扑树和信息通知 -->
        <Grid Grid.Row="1" Grid.Column="0" >
            <TabControl Style="{StaticResource TabControlSliding}" TabStripPlacement="Top">
                <TabItem Header="文件夹">
                    <!-- 文件夹结构拓扑树 -->
                    <GroupBox Header="URDF文件夹结构" Margin="5,5,5,5" Grid.Row="1" Style="{StaticResource GroupBoxTab}">
                        <TreeView Name="UrdfFileTreeView"  BorderThickness="0" ItemsSource="{Binding RootItems}">
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <TextBlock Text="{Binding Name}"/>
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </GroupBox>
                </TabItem>
                <TabItem Header="机器人">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="6*"/>
                            <RowDefinition Height="4*"/>
                        </Grid.RowDefinitions>
                        <!-- URDF拓扑树 -->
                        <GroupBox Header="机器人URDF" Margin="5,5,5,5" Grid.Row="0" Style="{StaticResource GroupBoxTab}">
                            <TreeView Name="UrdfTreeView"  BorderThickness="0"/>
                        </GroupBox>
                        <!-- 属性详情栏 -->
                        <GroupBox Header="属性详情"  Margin="5,0,5,5" Grid.Row="1" Style="{StaticResource GroupBoxTab}">
                            <DockPanel LastChildFill="True">
                                <ScrollViewer Name="InfoScrollViewer" BorderThickness="0" VerticalScrollBarVisibility="Auto" Background="Transparent" DockPanel.Dock="Top">
                                    <Grid Name="InfoGrid" Margin="0"/>
                                </ScrollViewer>
                                <TextBox Name="InfoCopyBox" IsReadOnly="True" TextWrapping="Wrap" BorderThickness="0" Background="Transparent" FontSize="12" Margin="0,4,0,0" VerticalScrollBarVisibility="Auto"/>
                            </DockPanel>
                        </GroupBox>
                    </Grid>
                </TabItem>
            </TabControl>
            
        </Grid>

        <!-- 状态栏（可展开历史） -->
        <StatusBar Grid.Row="2" Grid.ColumnSpan="2">
            <StatusBarItem HorizontalAlignment ="Right">
                <Expander x:Name="StatusExpander" ExpandDirection="Up" IsExpanded="False" Width="auto" BorderThickness="0" Background="Transparent">
                    <Expander.Header>
                        <TextBlock x:Name="StatusText" Text="就绪"/>
                    </Expander.Header>
                    <Border Padding="4" Background="White" MaxHeight="100">
                        <TextBox x:Name="StatusHistoryBox" FontSize="12" BorderThickness="0" IsReadOnly="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" AcceptsReturn="True"/>
                    </Border>
                </Expander>
            </StatusBarItem>
        </StatusBar>

    </Grid>
</Window>
